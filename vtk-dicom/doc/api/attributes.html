<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>vtk-dicom: Attributes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">vtk-dicom
   &#160;<span id="projectnumber">0.8.17</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Attributes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Managing DICOM meta data.</p>
<p><a class="anchor" id="md_Attributes"></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Overview</h1>
<p>The meta data can be loaded from a DICOM file in two ways: either via the <a class="el" href="classvtkDICOMReader.html" title="Read DICOM image files.">vtkDICOMReader</a> class (which also reads the image data), or via the <a class="el" href="classvtkDICOMParser.html" title="A meta data reader for DICOM data.">vtkDICOMParser</a> class (which reads only the meta data). These classes store the meta data in a <a class="el" href="classvtkDICOMMetaData.html" title="A container class for DICOM metadata.">vtkDICOMMetaData</a> object, which provides storage for all of the files in the DICOM series. The Get() method for this class, which returns the value of a DICOM attribute, accepts a file index as a parameter. This allows one to choose the file in the series for which to get the attribute.</p>
<div class="fragment"><div class="line"><span class="comment">// Get meta data from a vtkDICOMReader</span></div>
<div class="line">reader-&gt;UpdateInformation();</div>
<div class="line"><a class="code" href="classvtkDICOMMetaData.html">vtkDICOMMetaData</a> *meta = reader-&gt;GetMetaData();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the number of files for which &quot;meta&quot; holds meta-data</span></div>
<div class="line"><span class="keywordtype">int</span> n = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#ae1c81ebbc7da3d84adafebf0ed43f549">GetNumberOfInstances</a>();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get EchoTime attribute for first file in series.</span></div>
<div class="line"><span class="keywordflow">if</span> (meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#a91049abb7a5aee64bd2f687c189e9e94">Has</a>(DC::EchoTime))</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> fileIndex = 0;</div>
<div class="line">  <span class="keywordtype">double</span> t = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">Get</a>(fileIndex, DC::EchoTime).AsDouble();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// If fileIndex is not given, attribute is retrieved from first file.</span></div>
<div class="line">std::string str = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">Get</a>(DC::SeriesDescription).AsString();</div>
<div class="ttc" id="aclassvtkDICOMMetaData_html"><div class="ttname"><a href="classvtkDICOMMetaData.html">vtkDICOMMetaData</a></div><div class="ttdoc">A container class for DICOM metadata.</div><div class="ttdef"><b>Definition:</b> vtkDICOMMetaData.h:44</div></div>
<div class="ttc" id="aclassvtkDICOMMetaData_html_a91049abb7a5aee64bd2f687c189e9e94"><div class="ttname"><a href="classvtkDICOMMetaData.html#a91049abb7a5aee64bd2f687c189e9e94">vtkDICOMMetaData::Has</a></div><div class="ttdeci">bool Has(vtkDICOMTag tag)</div><div class="ttdoc">Check whether an attribute is present in the metadata.</div></div>
<div class="ttc" id="aclassvtkDICOMMetaData_html_ae1c81ebbc7da3d84adafebf0ed43f549"><div class="ttname"><a href="classvtkDICOMMetaData.html#ae1c81ebbc7da3d84adafebf0ed43f549">vtkDICOMMetaData::GetNumberOfInstances</a></div><div class="ttdeci">int GetNumberOfInstances()</div><div class="ttdoc">Get the number of instances (i.e. files).</div><div class="ttdef"><b>Definition:</b> vtkDICOMMetaData.h:64</div></div>
<div class="ttc" id="aclassvtkDICOMMetaData_html_afabe46f14518d256e1e0efe476da623d"><div class="ttname"><a href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">vtkDICOMMetaData::Get</a></div><div class="ttdeci">const vtkDICOMValue &amp; Get(vtkDICOMTag tag)</div><div class="ttdoc">Get an attribute value.</div></div>
</div><!-- fragment --><p>Attributes are returned as a <a class="el" href="classvtkDICOMValue.html" title="A class to store attribute values for DICOM metadata.">vtkDICOMValue</a> object, which has methods such as AsDouble(), AsInt() or AsString() that allow conversion of the value to various C++ types. If the DICOM file does not have the requested attribute, then the returned value will be empty and "value.IsValid()" will return "false". Calling AsString() on an invalid value will return the empty string, and likewise calling AsInt() or AsDouble() on an invalid value will return 0.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Per-slice meta data</h1>
<p>As discussed in the Overview, a "file index" can be used when retrieving an attribute from <a class="el" href="classvtkDICOMMetaData.html" title="A container class for DICOM metadata.">vtkDICOMMetaData</a>. It is important to note that this is a file index and not a slice index. The slices are sorted by spatial location, which might be different from the file order. Furthermore, a single DICOM file might actually contain multiple slices, with each slice stored in a different frame within the file.</p>
<p>The reader provides an array, the FileIndexArray, that can be used to convert a "slice index" to a file index. It also provides a FrameIndexArray that can be used to convert a slice index to a frame number. Together, these can be used regardless of whether the there was one slice per file, or one slice per frame in a multi-frame file: the <a class="el" href="classvtkDICOMMetaData.html" title="A container class for DICOM metadata.">vtkDICOMMetaData</a> object provides a Get() method that takes both a file index and a frame index, along with the tag of the attribute to be inspected.</p>
<div class="fragment"><div class="line"><span class="comment">// Read the files and get the meta data.</span></div>
<div class="line">reader-&gt;SetFileNames(fileNameArray);</div>
<div class="line">reader-&gt;Update();</div>
<div class="line"><a class="code" href="classvtkDICOMMetaData.html">vtkDICOMMetaData</a> *meta = reader-&gt;GetMetaData();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the arrays that map slice to file and frame.</span></div>
<div class="line">vtkIntArray *fileMap = reader-&gt;GetFileIndexArray();</div>
<div class="line">vtkIntArray *frameMap = reader-&gt;GetFrameIndexArray();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the file and frame for a particular slice.</span></div>
<div class="line"><span class="keywordtype">int</span> sliceIndex = 6;</div>
<div class="line"><span class="keywordtype">int</span> fileIndex = fileMap-&gt;GetComponent(sliceIndex, 0);</div>
<div class="line"><span class="keywordtype">int</span> frameIndex = frameMap-&gt;GetComponent(sliceIndex, 0);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the position for that slice.</span></div>
<div class="line"><a class="code" href="classvtkDICOMValue.html">vtkDICOMValue</a> pv = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">Get</a>(fileIdx, frameIdx, DC::ImagePositionPatient);</div>
<div class="line"><span class="keywordtype">double</span> position[3] = { 0.0, 0.0, 0.0 };</div>
<div class="line"><span class="keywordflow">if</span> (pv.<a class="code" href="classvtkDICOMValue.html#a042bf6e802263a9e522414be246c99fe">IsValid</a>() &amp;&amp; pv.<a class="code" href="classvtkDICOMValue.html#a21fbd2d98a94ef3f86dc7c8e467dd870">GetNumberOfValues</a>() == 3)</div>
<div class="line">{</div>
<div class="line">  pv.<a class="code" href="classvtkDICOMValue.html#ac035454006cb8805cd6b482e94483ded">GetValues</a>(position, 3);</div>
<div class="line">}</div>
<div class="ttc" id="aclassvtkDICOMValue_html"><div class="ttname"><a href="classvtkDICOMValue.html">vtkDICOMValue</a></div><div class="ttdoc">A class to store attribute values for DICOM metadata.</div><div class="ttdef"><b>Definition:</b> vtkDICOMValue.h:51</div></div>
<div class="ttc" id="aclassvtkDICOMValue_html_a042bf6e802263a9e522414be246c99fe"><div class="ttname"><a href="classvtkDICOMValue.html#a042bf6e802263a9e522414be246c99fe">vtkDICOMValue::IsValid</a></div><div class="ttdeci">bool IsValid() const</div><div class="ttdoc">Check whether this value is valid, i.e. contains data.</div><div class="ttdef"><b>Definition:</b> vtkDICOMValue.h:172</div></div>
<div class="ttc" id="aclassvtkDICOMValue_html_a21fbd2d98a94ef3f86dc7c8e467dd870"><div class="ttname"><a href="classvtkDICOMValue.html#a21fbd2d98a94ef3f86dc7c8e467dd870">vtkDICOMValue::GetNumberOfValues</a></div><div class="ttdeci">size_t GetNumberOfValues() const</div><div class="ttdoc">Get the value multiplicity.</div><div class="ttdef"><b>Definition:</b> vtkDICOMValue.h:207</div></div>
<div class="ttc" id="aclassvtkDICOMValue_html_ac035454006cb8805cd6b482e94483ded"><div class="ttname"><a href="classvtkDICOMValue.html#ac035454006cb8805cd6b482e94483ded">vtkDICOMValue::GetValues</a></div><div class="ttdeci">void GetValues(std::string *vb, size_t n, size_t i=0) const</div><div class="ttdoc">Copy &quot;n&quot; values into vb, starting at value &quot;i&quot;.</div></div>
</div><!-- fragment --><p>As a caveat, for multi-frame files, the example given above assumes that the meta data contains a per-frame ImagePositionPatient attribute. This is the case for enhanced multi-frame CT and MRI files, but not for multi-frame nuclear medicine files. Whenever retrieving meta data from a DICOM image, it is wise to consult the DICOM standard to see how the attributes are defined for the various modality-specific IODs (information object descriptions).</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Per-component meta data</h1>
<p>In the example in the previous section, the fileMap-&gt;GetComponent() method was called with two arguments, but the second argument was set to zero. If the <a class="el" href="classvtkDICOMReader.html" title="Read DICOM image files.">vtkDICOMReader</a> assigned a vector dimension to the data, then the the vtkImageData will have multiple scalar values in each voxel. For instance, the first component in each voxel may have come from a file that provided the real component of a complex-valued image, while the second component from a file that provided the imaginary component. In this case, one would do the following to retrieve the meta data from the "imaginary" file:</p>
<div class="fragment"><div class="line"><span class="comment">// Read the files and get the meta data.</span></div>
<div class="line">reader-&gt;SetFileNames(fileNameArray);</div>
<div class="line">reader-&gt;Update();</div>
<div class="line"><a class="code" href="classvtkDICOMMetaData.html">vtkDICOMMetaData</a> *metaData = reader-&gt;GetMetaData();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the arrays that map slice to file and frame.</span></div>
<div class="line">vtkIntArray *fileMap = reader-&gt;GetFileIndexArray();</div>
<div class="line">vtkIntArray *frameMap = reader-&gt;GetFrameIndexArray();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the file and frame for a particular slice and component.</span></div>
<div class="line"><span class="keywordtype">int</span> sliceIndex = 6;</div>
<div class="line"><span class="keywordtype">int</span> vectorIndex = 1; <span class="comment">// 2nd component is the imaginary component</span></div>
<div class="line"><span class="keywordtype">int</span> fileIndex = fileMap-&gt;GetComponent(sliceIndex, vectorIndex);</div>
<div class="line"><span class="keywordtype">int</span> frameIndex = frameMap-&gt;GetComponent(sliceIndex, vectorIndex);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get an attribute from the meta data.</span></div>
<div class="line"><a class="code" href="classvtkDICOMValue.html">vtkDICOMValue</a> v = metaData-&gt;<a class="code" href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">Get</a>(fileIdx, frameIdx, tag);</div>
</div><!-- fragment --><p>If the data has a time dimension and the reader's TimeAsVectorOn() method was called, then the components of each voxel can correspond both to a specific time slot, and to a specific vector component. To make the situation even more complicated, each pixel in the DICOM files might be an RGB pixel and therefore have three components as given by the SamplesPerPixel attribute in the meta data.</p>
<p>The number of components in the FileIndexArray and FrameIndexArray is equal to the vector dimension, and if TimeAsVectorOn() was called, then the vector dimension will include the time dimension. The FileIndexArray and FrameIndexArray do not have components that correspond to the individual R,G,B components in RGB images, since the R, G, and B components will always have the same meta data because they always come from the same file and frame.</p>
<p>The following strategy is recommended for accessing per-component meta data in multi-dimensional images:</p>
<div class="fragment"><div class="line"><span class="comment">// Get the arrays that map slice to file and frame.</span></div>
<div class="line">vtkIntArray *fileMap = reader-&gt;GetFileIndexArray();</div>
<div class="line">vtkIntArray *frameMap = reader-&gt;GetFrameIndexArray();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the image data and meta data.</span></div>
<div class="line">vtkImageData *image = reader-&gt;GetOutput();</div>
<div class="line"><a class="code" href="classvtkDICOMMetaData.html">vtkDICOMMetaData</a> *meta = reader-&gt;GetMetaData();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the number of components in the data.</span></div>
<div class="line"><span class="keywordtype">int</span> numComponents = image-&gt;GetNumberOfScalarComponents();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the full vector dimension for the DICOM data.</span></div>
<div class="line"><span class="keywordtype">int</span> vectorDimension = fileMap-&gt;GetNumberOfComponents();</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Compute the samples per pixel in original files.</span></div>
<div class="line"><span class="keywordtype">int</span> samplesPerPixel = numComponents/vectorDimension;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check for time dimension</span></div>
<div class="line"><span class="keywordtype">int</span> timeDimension = reader-&gt;GetTimeDimension();</div>
<div class="line"><span class="keywordflow">if</span> (timeDimension == 0)</div>
<div class="line">{</div>
<div class="line">  timeDimension = 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get all attributes for a specific time.</span></div>
<div class="line"><span class="keywordtype">int</span> vectorIndex = timeIndex*vectorDimension/timeDimension;</div>
<div class="line"><span class="keywordtype">int</span> vectorEndIndex = (timeIndex + 1)*vectorDimension/timeDimension;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = vectorIndex; i &lt; vectorEndIndex; i++)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span> fileIndex = fileMap-&gt;GetComponent(sliceIndex, i);</div>
<div class="line">  <span class="keywordtype">int</span> frameIndex = frameMap-&gt;GetComponent(sliceIndex, i);</div>
<div class="line">  <a class="code" href="classvtkDICOMValue.html">vtkDICOMValue</a> v = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">Get</a>(fileIdx, frameIdx, tag);</div>
<div class="line">  <span class="comment">// print or display the value</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Extract an image at the desired time slot (e.g. for display).</span></div>
<div class="line"><span class="keywordtype">int</span> componentIndex = timeIndex*vectorDimension/timeDimension*samplesPerPixel;</div>
<div class="line">vtkNew&lt;vtkImageExtractComponents&gt; extractor;</div>
<div class="line">extractor-&gt;SetInputConnection(reader-&gt;GetOutputPort());</div>
<div class="line"><span class="keywordflow">if</span> (samplesPerPixel == 1)</div>
<div class="line">{</div>
<div class="line">  extractor-&gt;SetComponents(componentIndex);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span> (samplesPerPixel == 2) <span class="comment">// rare/nonexistent in DICOM images</span></div>
<div class="line">{</div>
<div class="line">  extractor-&gt;SetComponents(componentIndex, componentIndex + 1);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">  extractor-&gt;SetComponents(componentIndex, componentIndex + 1, componentIndex + 2);</div>
<div class="line">}</div>
<div class="line">extractor-&gt;Update();</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md3"></a>
Nested data, tag paths, and multi-frame files</h1>
<p>DICOM meta data can be nested. For example, nesting is used to store per-frame meta data for enhanced multi-frame DICOM files. In order to make it easy to access nested attributes, the <a class="el" href="classvtkDICOMTagPath.html" title="A tag path for digging values out of sequence items.">vtkDICOMTagPath</a> class describes the full path to a nested attribute.</p>
<div class="fragment"><div class="line"><span class="comment">// Get an attribute for frame 3 of a multi-frame file.</span></div>
<div class="line"><span class="keywordtype">int</span> frameIdx = 3;</div>
<div class="line"><span class="keywordtype">double</span> echoTime = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">Get</a>(</div>
<div class="line">  <a class="code" href="classvtkDICOMTagPath.html">vtkDICOMTagPath</a>(DC::PerFrameFunctionalGroupSequence, frameIdx,</div>
<div class="line">                  DC::CardiacSynchronizationSequence, 0,</div>
<div class="line">                  DC::NominalCardiacTriggerDelayTime)).AsDouble();</div>
<div class="ttc" id="aclassvtkDICOMTagPath_html"><div class="ttname"><a href="classvtkDICOMTagPath.html">vtkDICOMTagPath</a></div><div class="ttdoc">A tag path for digging values out of sequence items.</div><div class="ttdef"><b>Definition:</b> vtkDICOMTagPath.h:27</div></div>
</div><!-- fragment --><p>This is rather verbose, so a more convenient method for accessing per-frame data is provided for enhanced multi-frame files. You can give the frame index after the file index, in which case the Get() method will perform a search for the attribute without requiring a full path.</p>
<div class="fragment"><div class="line"><span class="comment">// Get an attribute for frame 3 of an enhanced multi-frame file.</span></div>
<div class="line"><span class="keywordtype">int</span> fileIdx = 0;</div>
<div class="line"><span class="keywordtype">int</span> frameIdx = 3;</div>
<div class="line"><a class="code" href="classvtkDICOMValue.html">vtkDICOMValue</a> vw = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">Get</a>(fileIdx, frameIdx, DC::WindowWidth);</div>
<div class="line"><a class="code" href="classvtkDICOMValue.html">vtkDICOMValue</a> vc = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">Get</a>(fileIdx, frameIdx, DC::WindowCenter);</div>
<div class="line"><span class="keywordflow">if</span> (vw.<a class="code" href="classvtkDICOMValue.html#a042bf6e802263a9e522414be246c99fe">IsValid</a>() &amp;&amp; vc.<a class="code" href="classvtkDICOMValue.html#a042bf6e802263a9e522414be246c99fe">IsValid</a>())</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// set the window for the image</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The <a class="el" href="classvtkDICOMMetaDataAdapter.html" title="An adapter to make multi-frame data look like multi-file data.">vtkDICOMMetaDataAdapter</a> class can also be used to access enhanced multi-frame files as if each frame was a separate file.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Iterating over data elements</h1>
<p>The <a class="el" href="classvtkDICOMMetaData.html" title="A container class for DICOM metadata.">vtkDICOMMetaData</a> object also provides iterator-style access to the data elements. This is useful, for instance, when you want to iterate through all of the elements in the meta data in sequential order. It is also useful if you want to check which attributes vary between files in the series.</p>
<div class="fragment"><div class="line"><span class="comment">// Iterate through all data elements in the meta data.</span></div>
<div class="line"><span class="keywordflow">for</span> (<a class="code" href="classvtkDICOMDataElementIterator.html">vtkDICOMDataElementIterator</a> iter = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#ae075ebd9b64eac1099dd3689a9c9e6a0">Begin</a>(); iter != meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#a19c506e4a5d0ea4d102e186b5b6a323a">End</a>(); ++iter)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="classvtkDICOMTag.html">vtkDICOMTag</a> tag = iter-&gt;GetTag();</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;tag: &quot;</span> &lt;&lt; tag &lt;&lt; std::endl;</div>
<div class="line">  <span class="comment">// Crucial step: check for values that vary across the series.</span></div>
<div class="line">  <span class="keywordflow">if</span> (iter-&gt;IsPerInstance())</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordtype">int</span> n = iter-&gt;GetNumberOfInstances();</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;instance &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;: &quot;</span> &lt;&lt; iter-&gt;GetValue(i) &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span></div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// Not PerInstance: value is the same for all files in series.</span></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;all instances: &quot;</span> &lt;&lt; iter-&gt;GetValue() &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get the iterator to a specific element (hash table lookup).</span></div>
<div class="line"><a class="code" href="classvtkDICOMDataElementIterator.html">vtkDICOMDataElementIterator</a> iter = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#a82a038e0770cf0e3b65a0d8e6d85c5dc">Find</a>(DC::ImageOrientationPatient);</div>
<div class="line"><span class="keywordflow">if</span> (iter != meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#a19c506e4a5d0ea4d102e186b5b6a323a">End</a>())</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// do something</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassvtkDICOMDataElementIterator_html"><div class="ttname"><a href="classvtkDICOMDataElementIterator.html">vtkDICOMDataElementIterator</a></div><div class="ttdoc">A const iterator for a vtkDataElement list.</div><div class="ttdef"><b>Definition:</b> vtkDICOMDataElement.h:88</div></div>
<div class="ttc" id="aclassvtkDICOMMetaData_html_a19c506e4a5d0ea4d102e186b5b6a323a"><div class="ttname"><a href="classvtkDICOMMetaData.html#a19c506e4a5d0ea4d102e186b5b6a323a">vtkDICOMMetaData::End</a></div><div class="ttdeci">vtkDICOMDataElementIterator End()</div><div class="ttdoc">Get an end iterator for the list of data elements.</div><div class="ttdef"><b>Definition:</b> vtkDICOMMetaData.h:86</div></div>
<div class="ttc" id="aclassvtkDICOMMetaData_html_a82a038e0770cf0e3b65a0d8e6d85c5dc"><div class="ttname"><a href="classvtkDICOMMetaData.html#a82a038e0770cf0e3b65a0d8e6d85c5dc">vtkDICOMMetaData::Find</a></div><div class="ttdeci">vtkDICOMDataElementIterator Find(vtkDICOMTag tag)</div><div class="ttdoc">Get the iterator for a specific data element.</div><div class="ttdef"><b>Definition:</b> vtkDICOMMetaData.h:95</div></div>
<div class="ttc" id="aclassvtkDICOMMetaData_html_ae075ebd9b64eac1099dd3689a9c9e6a0"><div class="ttname"><a href="classvtkDICOMMetaData.html#ae075ebd9b64eac1099dd3689a9c9e6a0">vtkDICOMMetaData::Begin</a></div><div class="ttdeci">vtkDICOMDataElementIterator Begin()</div><div class="ttdoc">Get an iterator for the list of data elements.</div><div class="ttdef"><b>Definition:</b> vtkDICOMMetaData.h:82</div></div>
<div class="ttc" id="aclassvtkDICOMTag_html"><div class="ttname"><a href="classvtkDICOMTag.html">vtkDICOMTag</a></div><div class="ttdoc">A (group,element) identifier tag for DICOM attributes.</div><div class="ttdef"><b>Definition:</b> vtkDICOMTag.h:23</div></div>
</div><!-- fragment --><p>You might be surprised by the PerInstance check, but it is necessary due to the fact that <a class="el" href="classvtkDICOMMetaData.html" title="A container class for DICOM metadata.">vtkDICOMMetaData</a> holds the meta data for an entire series of DICOM files. Most attributes are the same across the series, but a few attributes vary from one file to the next. These per-file attributes are identified when the file is read by <a class="el" href="classvtkDICOMReader.html" title="Read DICOM image files.">vtkDICOMReader</a>.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Dictionaries</h1>
<p>When iterating through the data elements in the meta data, as described in the previous section, it can be useful to get information about the meaning of the data elements that are encountered. Complete information can only be provided by the DICOM standards documents themselves, but the <a class="el" href="classvtkDICOMDictionary.html" title="Provide access to the DICOM tag dictionary.">vtkDICOMDictionary</a> can at least provide a summary of what kind of data to expect for a given attribute.</p>
<div class="fragment"><div class="line"><span class="comment">// do a dictionary lookup on a tag</span></div>
<div class="line"><a class="code" href="classvtkDICOMDictEntry.html">vtkDICOMDictEntry</a> entry;</div>
<div class="line">entry = <a class="code" href="classvtkDICOMDictionary.html#a65fd33cca2c85a1d6e8dcc0d6f99c93b">vtkDICOMDictionary::FindDictEntry</a>(<a class="code" href="classvtkDICOMTag.html">vtkDICOMTag</a>(0x0008,0x0020));</div>
<div class="line"><span class="comment">// check if entry was found in dictionary</span></div>
<div class="line"><span class="keywordflow">if</span> (entry.<a class="code" href="classvtkDICOMDictEntry.html#a6dc9e7d9ee3e05e7be347eff966327f0">IsValid</a>())</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; entry.<a class="code" href="classvtkDICOMDictEntry.html#af6c88edad387ed12db5e332bb1d29331">GetName</a>() &lt;&lt; std::endl; <span class="comment">// prints &quot;StudyDate&quot;</span></div>
<div class="line">  std::cout &lt;&lt; entry.<a class="code" href="classvtkDICOMDictEntry.html#ae2746e0e4eb4e1ff9440fc9978168d26">GetVR</a>() &lt;&lt; std::endl; <span class="comment">// prints &quot;DA&quot;</span></div>
<div class="line">  std::cout &lt;&lt; entry.<a class="code" href="classvtkDICOMDictEntry.html#a74fb3c156e7f2cd38056f9a571323007">GetVM</a>() &lt;&lt; std::endl; <span class="comment">// prints &quot;1&quot;</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// do a dictionary lookup by name</span></div>
<div class="line">entry = <a class="code" href="classvtkDICOMDictionary.html#a65fd33cca2c85a1d6e8dcc0d6f99c93b">vtkDICOMDictionary::FindDictEntry</a>(<span class="stringliteral">&quot;StudyDate&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (entry.<a class="code" href="classvtkDICOMDictEntry.html#a6dc9e7d9ee3e05e7be347eff966327f0">IsValid</a>())</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; entry.<a class="code" href="classvtkDICOMDictEntry.html#a5e3942f6e85fcdf6e2fe64f2149db809">GetTag</a>() &lt;&lt; std::endl; <span class="comment">// prints &quot;0008,0020&quot;</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassvtkDICOMDictEntry_html"><div class="ttname"><a href="classvtkDICOMDictEntry.html">vtkDICOMDictEntry</a></div><div class="ttdoc">An entry in the DICOM dictionary.</div><div class="ttdef"><b>Definition:</b> vtkDICOMDictEntry.h:24</div></div>
<div class="ttc" id="aclassvtkDICOMDictEntry_html_a5e3942f6e85fcdf6e2fe64f2149db809"><div class="ttname"><a href="classvtkDICOMDictEntry.html#a5e3942f6e85fcdf6e2fe64f2149db809">vtkDICOMDictEntry::GetTag</a></div><div class="ttdeci">vtkDICOMTag GetTag() const</div><div class="ttdoc">Get the DICOM tag for this dictionary entry.</div><div class="ttdef"><b>Definition:</b> vtkDICOMDictEntry.h:45</div></div>
<div class="ttc" id="aclassvtkDICOMDictEntry_html_a6dc9e7d9ee3e05e7be347eff966327f0"><div class="ttname"><a href="classvtkDICOMDictEntry.html#a6dc9e7d9ee3e05e7be347eff966327f0">vtkDICOMDictEntry::IsValid</a></div><div class="ttdeci">bool IsValid() const</div><div class="ttdoc">Check whether the returned entry is valid.</div><div class="ttdef"><b>Definition:</b> vtkDICOMDictEntry.h:41</div></div>
<div class="ttc" id="aclassvtkDICOMDictEntry_html_a74fb3c156e7f2cd38056f9a571323007"><div class="ttname"><a href="classvtkDICOMDictEntry.html#a74fb3c156e7f2cd38056f9a571323007">vtkDICOMDictEntry::GetVM</a></div><div class="ttdeci">vtkDICOMVM GetVM() const</div><div class="ttdoc">Get the VM for this dictionary entry.</div><div class="ttdef"><b>Definition:</b> vtkDICOMDictEntry.h:53</div></div>
<div class="ttc" id="aclassvtkDICOMDictEntry_html_ae2746e0e4eb4e1ff9440fc9978168d26"><div class="ttname"><a href="classvtkDICOMDictEntry.html#ae2746e0e4eb4e1ff9440fc9978168d26">vtkDICOMDictEntry::GetVR</a></div><div class="ttdeci">vtkDICOMVR GetVR() const</div><div class="ttdoc">Get the VR for this dictionary entry.</div><div class="ttdef"><b>Definition:</b> vtkDICOMDictEntry.h:49</div></div>
<div class="ttc" id="aclassvtkDICOMDictEntry_html_af6c88edad387ed12db5e332bb1d29331"><div class="ttname"><a href="classvtkDICOMDictEntry.html#af6c88edad387ed12db5e332bb1d29331">vtkDICOMDictEntry::GetName</a></div><div class="ttdeci">const char * GetName() const</div><div class="ttdoc">Get a human-readable name for this dictionary entry.</div><div class="ttdef"><b>Definition:</b> vtkDICOMDictEntry.h:57</div></div>
<div class="ttc" id="aclassvtkDICOMDictionary_html_a65fd33cca2c85a1d6e8dcc0d6f99c93b"><div class="ttname"><a href="classvtkDICOMDictionary.html#a65fd33cca2c85a1d6e8dcc0d6f99c93b">vtkDICOMDictionary::FindDictEntry</a></div><div class="ttdeci">static vtkDICOMDictEntry FindDictEntry(const vtkDICOMTag tag)</div><div class="ttdoc">Find the dictionary entry for the given tag.</div><div class="ttdef"><b>Definition:</b> vtkDICOMDictionary.h:44</div></div>
</div><!-- fragment --><p>The <a class="el" href="classvtkDICOMDictionary.html" title="Provide access to the DICOM tag dictionary.">vtkDICOMDictionary</a> class provides information for attributes that are described in the DICOM standard, as well as information for private attributes defined by medical device manufacturers. Every DICOM file is likely to have a mix of standard attributes and private attributes. Fortunately, it is easy to tell the difference between the two: private attributes always use a tag with with an odd group number, while the DICOM standard only uses even group numbers. The lookup of private tags requires the name of the private dictionary.</p>
<div class="fragment"><div class="line"><span class="comment">// do a private dictionary lookup in GE dictionary GEMS_ACQU_01</span></div>
<div class="line"><a class="code" href="classvtkDICOMDictEntry.html">vtkDICOMDictEntry</a> entry;</div>
<div class="line">entry = <a class="code" href="classvtkDICOMDictionary.html#a65fd33cca2c85a1d6e8dcc0d6f99c93b">vtkDICOMDictionary::FindDictEntry</a>(<span class="stringliteral">&quot;CellSpacing&quot;</span>, <span class="stringliteral">&quot;GEMS_ACQU_01&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (entry.<a class="code" href="classvtkDICOMDictEntry.html#a6dc9e7d9ee3e05e7be347eff966327f0">IsValid</a>())</div>
<div class="line">{</div>
<div class="line">  std::cout &lt;&lt; entry.<a class="code" href="classvtkDICOMDictEntry.html#a5e3942f6e85fcdf6e2fe64f2149db809">GetTag</a>() &lt;&lt; std::endl; <span class="comment">// prints &quot;0019,0004&quot;</span></div>
<div class="line">  std::cout &lt;&lt; entry.<a class="code" href="classvtkDICOMDictEntry.html#af6c88edad387ed12db5e332bb1d29331">GetName</a>() &lt;&lt; std::endl; <span class="comment">// prints &quot;CellSpacing&quot;</span></div>
<div class="line">  std::cout &lt;&lt; entry.<a class="code" href="classvtkDICOMDictEntry.html#ae2746e0e4eb4e1ff9440fc9978168d26">GetVR</a>() &lt;&lt; std::endl; <span class="comment">// prints &quot;DS&quot;</span></div>
<div class="line">  std::cout &lt;&lt; entry.<a class="code" href="classvtkDICOMDictEntry.html#a74fb3c156e7f2cd38056f9a571323007">GetVM</a>() &lt;&lt; std::endl; <span class="comment">// prints &quot;1&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md6"></a>
Private meta data</h1>
<p>Because private tags are not registered with any central authority, there is no guarantee that they are unique. Instead, each private group within a DICOM file contains 240 blocks (each with 256 elements) that can be be individually reserved for elements belonging to a specific private dictionary. The details of how this is done are described in Part 5, Section 7.8 of the DICOM standard.</p>
<p>The result of this is that private tags are of the form (gggg,xxee) where "xx" is a hexadecimal value between <code>10</code> and <code>ff</code> that identifies the block that was used to store the attribute. The tricky thing is that this value can vary from one DICOM file to the next, though it is usually consistent within a single series. Some people are surprised by this, because the first block (i.e. <code>10</code>) is the only block that is used in most files.</p>
<p>To ensure that you are looking for private attributes in the correct location (i.e. within the correct block), you must resolve each private tag before using it.</p>
<div class="fragment"><div class="line"><span class="comment">// start with the tag in its &quot;dictionary&quot; form, with xx=00</span></div>
<div class="line"><a class="code" href="classvtkDICOMTag.html">vtkDICOMTag</a> ptag = <a class="code" href="classvtkDICOMTag.html">vtkDICOMTag</a>(0019,0004);</div>
<div class="line"><span class="comment">// resolve the private tag (find out what block was reserved)</span></div>
<div class="line">ptag = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#abee072ea5f551227696b581fcb6dd7a4">ResolvePrivateTag</a>(ptag, <span class="stringliteral">&quot;GEMS_ACQU_01&quot;</span>);</div>
<div class="line"><span class="keywordflow">if</span> (ptag == <a class="code" href="classvtkDICOMTag.html">vtkDICOMTag</a>(0xffff,0xffff))</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// the special tag value ffff,ffff indicates that the tag could not be</span></div>
<div class="line">  <span class="comment">// resolved: no private block was reserved for dictionary GEMS_ACQU_01</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">  <span class="comment">// ptag will now be 0019,xx04 where &quot;xx&quot; is usually 10 (first block)</span></div>
<div class="line">  <span class="keywordtype">double</span> spacing = meta-&gt;<a class="code" href="classvtkDICOMMetaData.html#afabe46f14518d256e1e0efe476da623d">Get</a>(ptag).AsDouble();</div>
<div class="line">}</div>
<div class="ttc" id="aclassvtkDICOMMetaData_html_abee072ea5f551227696b581fcb6dd7a4"><div class="ttname"><a href="classvtkDICOMMetaData.html#abee072ea5f551227696b581fcb6dd7a4">vtkDICOMMetaData::ResolvePrivateTag</a></div><div class="ttdeci">vtkDICOMTag ResolvePrivateTag(vtkDICOMTag ptag, const std::string &amp;creator)</div><div class="ttdoc">Resolve a private tag, or return (ffff,ffff) if not resolved.</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Nov 3 2024 05:59:20 for vtk-dicom by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
