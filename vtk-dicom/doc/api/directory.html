<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>vtk-dicom: Directories</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">vtk-dicom
   &#160;<span id="projectnumber">0.8.7</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Directories </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Reading a directory that contains DICOM files.</p>
<h2>DICOM file directory</h2>
<p>DICOM files rarely have descriptive names, so it is usually necessary to identify them by their contents. A typical DICOM folder listing looks something like this:</p>
<div class="fragment"><div class="line">IM-0001-0001.dcm  IM-0001-0005.dcm  IM-0001-0009.dcm  IM-0001-0013.dcm</div>
<div class="line">IM-0001-0002.dcm  IM-0001-0006.dcm  IM-0001-0010.dcm  IM-0001-0014.dcm</div>
<div class="line">IM-0001-0003.dcm  IM-0001-0007.dcm  IM-0001-0011.dcm  IM-0001-0015.dcm</div>
<div class="line">IM-0001-0004.dcm  IM-0001-0008.dcm  IM-0001-0012.dcm  IM-0001-0016.dcm</div>
</div><!-- fragment --><p>These files might be 16 slices of a 3D image, or the first three files might be localizer images while the remaining 13 files are slices of a 3D volume. Or they might be something else entirely. So the first thing to do with a batch of DICOM files is to find out how they fit together. There are two classes that can be used for this: the old <a class="el" href="classvtk_d_i_c_o_m_file_sorter.html" title="Sort DICOM files and group them by study and series. ">vtkDICOMFileSorter</a> class, and the newer <a class="el" href="classvtk_d_i_c_o_m_directory.html" title="Get information about all DICOM files within a directory. ">vtkDICOMDirectory</a> class.</p>
<h2>Scanning a directory</h2>
<p>The <a class="el" href="classvtk_d_i_c_o_m_directory.html" title="Get information about all DICOM files within a directory. ">vtkDICOMDirectory</a> class solves this problem by scanning the directory and reporting information on all of the DICOM files that it finds. In addition, if the directory contains a <b>DICOMDIR</b> file (as is the case for a DICOM CD), then the DICOMDIR file is used as an index. In the simplest case, the directory will contain a single series as in the example below. Since the example is looking for images (and not for other DICOM files such as structured reports), the RequirePixelData flag is set:</p>
<div class="fragment"><div class="line">vtkNew&lt;vtkDICOMDirectory&gt; dicomdir;</div>
<div class="line">dicomdir-&gt;SetDirectoryName(<span class="stringliteral">&quot;E:&quot;</span>);</div>
<div class="line">dicomdir-&gt;RequirePixelDataOn();</div>
<div class="line">dicomdir-&gt;Update();</div>
<div class="line"><span class="keywordtype">int</span> n = dicomdir-&gt;GetNumberOfSeries();</div>
<div class="line"></div>
<div class="line">vtkNew&lt;vtkDICOMReader&gt; reader;</div>
<div class="line"><span class="keywordflow">if</span> (n &gt; 0)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// read the first series found</span></div>
<div class="line">  reader-&gt;SetFileNames(dicomdir-&gt;GetFileNamesForSeries(0));</div>
<div class="line">  reader-&gt;Update();</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">{</div>
<div class="line">  std::cerr &lt;&lt; <span class="stringliteral">&quot;No DICOM images in directory!&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Since <a class="el" href="classvtk_d_i_c_o_m_directory.html" title="Get information about all DICOM files within a directory. ">vtkDICOMDirectory</a> will scan subdirectories recursively, it can be used to catalogue a large collection of DICOM files:</p>
<div class="fragment"><div class="line"><span class="comment">// Iterate through all of the studies that are present.</span></div>
<div class="line"><span class="keywordtype">int</span> n = dicomdir-&gt;GetNumberOfStudies();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Get information related to the patient study</span></div>
<div class="line">  <a class="code" href="classvtk_d_i_c_o_m_item.html">vtkDICOMItem</a> patient = dicomdir-&gt;GetPatientRecordForStudy(i);</div>
<div class="line">  <a class="code" href="classvtk_d_i_c_o_m_item.html">vtkDICOMItem</a> study = dicomdir-&gt;GetStudyRecord(i);</div>
<div class="line">  std::cout &lt;&lt; patient.<a class="code" href="classvtk_d_i_c_o_m_item.html#af77f1eaa0919164dec8e9e4a17998a8c">Get</a>(DC::PatientName) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; patient.<a class="code" href="classvtk_d_i_c_o_m_item.html#af77f1eaa0919164dec8e9e4a17998a8c">Get</a>(DC::PatientID) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; study.<a class="code" href="classvtk_d_i_c_o_m_item.html#af77f1eaa0919164dec8e9e4a17998a8c">Get</a>(DC::StudyDate) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line">  std::cout &lt;&lt; study.<a class="code" href="classvtk_d_i_c_o_m_item.html#af77f1eaa0919164dec8e9e4a17998a8c">Get</a>(DC::StudyTime) &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Iterate through all of the series in this study.</span></div>
<div class="line">  <span class="keywordtype">int</span> j1 = dicomdir-&gt;GetFirstSeriesForStudy(i);</div>
<div class="line">  <span class="keywordtype">int</span> j2 = dicomdir-&gt;GetLastSeriesForStudy(i);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = j1; j &lt;= j2; j++)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// get some of the series attributes as a vtkDICOMItem</span></div>
<div class="line">    <a class="code" href="classvtk_d_i_c_o_m_item.html">vtkDICOMItem</a> series = dicomdir-&gt;GetSeriesRecord(j);</div>
<div class="line">    <span class="comment">// get all the files in the series</span></div>
<div class="line">    vtkStringArray *sortedFiles = dicomdir-&gt;GetFileNamesForSeries(j);</div>
<div class="line">    std::cout &lt;&lt; sortedFiles.GetNumberOfValues() &lt;&lt; <span class="stringliteral">&quot; files: &quot;</span>;</div>
<div class="line">    std::cout &lt;&lt; series.<a class="code" href="classvtk_d_i_c_o_m_item.html#af77f1eaa0919164dec8e9e4a17998a8c">Get</a>(DC::SeriesInstanceUID) &lt;&lt; std::endl;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>The PatientRecord, StudyRecord, and SeriesRecord in the above example contain attributes for the images that were stored in the DICOMDIR index file. At the bare minimum, these will provide the PatientName, PatientID, StudyDate, StudyTime, StudyInstanceUID, and SeriesInstanceUID. Usually the StudyDescription, SeriesDescription and SeriesNumber are also available. Furthermore, the method GetMetaDataForSeries() returns an amalgamation of the Patient, Study, Series, and Image information as a <a class="el" href="classvtk_d_i_c_o_m_meta_data.html" title="A container class for DICOM metadata. ">vtkDICOMMetaData</a> object (though the per-image information is sometimes limited to just the InstanceNumber and the SOPInstanceUID).</p>
<h3>Searching for files that match a query</h3>
<p>The <a class="el" href="classvtk_d_i_c_o_m_directory.html" title="Get information about all DICOM files within a directory. ">vtkDICOMDirectory</a> class has another trick up its sleeve. It can search for files that have certain attributes, for example it can search a filesystem for all scans of a specific patient. This is similar in purpose to querying a PACS system, except that you are instead providing one or more disk directories where the files might exist. These directories are searched recursively for all files that match the query.</p>
<div class="fragment"><div class="line"><span class="comment">// Make a list of the directories to search.</span></div>
<div class="line">vtkNew&lt;vtkStringArray&gt; dicompath;</div>
<div class="line">dicompath-&gt;InsertNextValue(<span class="stringliteral">&quot;/Volumes/Images1&quot;</span>);</div>
<div class="line">dicompath-&gt;InsertNextValue(<span class="stringliteral">&quot;/Volumes/Images2&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Make a list of attributes to match, using the utf-8 character set.</span></div>
<div class="line"><a class="code" href="classvtk_d_i_c_o_m_item.html">vtkDICOMItem</a> query;</div>
<div class="line">query.<a class="code" href="classvtk_d_i_c_o_m_item.html#ada3e1cd2745c15de677c85eaf7053cdb">Set</a>(DC::SpecificCharacterSet, <span class="stringliteral">&quot;ISO_IR 192&quot;</span>);</div>
<div class="line">query.<a class="code" href="classvtk_d_i_c_o_m_item.html#ada3e1cd2745c15de677c85eaf7053cdb">Set</a>(DC::PatientName, <span class="stringliteral">&quot;Doe^John&quot;</span>);</div>
<div class="line">query.<a class="code" href="classvtk_d_i_c_o_m_item.html#ada3e1cd2745c15de677c85eaf7053cdb">Set</a>(DC::StudyDate, <span class="stringliteral">&quot;2012-2015&quot;</span>);</div>
<div class="line">query.<a class="code" href="classvtk_d_i_c_o_m_item.html#ada3e1cd2745c15de677c85eaf7053cdb">Set</a>(DC::Modality, <span class="stringliteral">&quot;MR&quot;</span>);</div>
<div class="line">query.<a class="code" href="classvtk_d_i_c_o_m_item.html#ada3e1cd2745c15de677c85eaf7053cdb">Set</a>(DC::ImageType, <span class="stringliteral">&quot;PRIMARY&quot;</span>);</div>
<div class="line">query.<a class="code" href="classvtk_d_i_c_o_m_item.html#ada3e1cd2745c15de677c85eaf7053cdb">Set</a>(DC::SeriesDescription, <span class="stringliteral">&quot;*T1w*&quot;</span>);</div>
<div class="line"></div>
<div class="line">vtkNew&lt;vtkDICOMDirectory&gt; dicomdir;</div>
<div class="line"><span class="comment">// The SetInputFileNames method takes directories, too!</span></div>
<div class="line">dicomdir-&gt;SetInputFileNames(dicompath.GetPointer());</div>
<div class="line"><span class="comment">// Optionally restrict the search to files ending with &quot;.dcm&quot;</span></div>
<div class="line">dicomdir-&gt;SetFilePattern(<span class="stringliteral">&quot;*.dcm&quot;</span>);</div>
<div class="line">dicomdir-&gt;SetFindQuery(query);</div>
<div class="line">dicomdir-&gt;Update();</div>
</div><!-- fragment --><p>All text attributes except for dates accept the wildcards '*' and '?'. For dates, you can use a hyphen to specify a range of dates. Matching of all text is done by first converting the text to utf-8 for compatibility, and for patient names the matching is case insensitive. The query <b>PRIMARY</b> will match the multi-valued attribute value <b>ORIGINAL\PRIMARY</b>, since only one value has to match.</p>
<p>If the query contains any non-ASCII text, you must set the SpecificCharacterSet attribute to whichever character set your program uses internally. This does not have to be the same as the character set used in the files you are searching for. It is recommended to use utf-8 as the character set for the query, regardless of the character set used in the DICOM files.</p>
<h2>Sorting a list of files</h2>
<p>The <a class="el" href="classvtk_d_i_c_o_m_file_sorter.html" title="Sort DICOM files and group them by study and series. ">vtkDICOMFileSorter</a> class is obsolete, since its capabilities are eclipsed by the <a class="el" href="classvtk_d_i_c_o_m_directory.html" title="Get information about all DICOM files within a directory. ">vtkDICOMDirectory</a> class, but its use is documented here for historical reasons. It is also worth stating that the "sorting" provided by this class is, in fact, unnecessary: the <a class="el" href="classvtk_d_i_c_o_m_reader.html" title="Read DICOM image files. ">vtkDICOMReader</a> itself is capable of sorting its input files into the correct order.</p>
<div class="fragment"><div class="line"><span class="comment">// Instantiate a DICOM sorter.</span></div>
<div class="line">vtkNew&lt;vtkDICOMFileSorter&gt; sorter;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Provide an array containing a list of filenames.</span></div>
<div class="line">sorter-&gt;SetInputFileNames(filenames);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Update the sorter (i.e. perform the sort).</span></div>
<div class="line">sorter-&gt;Update();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Get the first series.</span></div>
<div class="line"><span class="keywordtype">int</span> i = sorter-&gt;GetNumberOfSeries();</div>
<div class="line"><span class="keywordflow">if</span> (i &gt; 0)</div>
<div class="line">{</div>
<div class="line">  vtkStringArray *sortedFiles = sorter-&gt;GetFileNamesForSeries(0);</div>
<div class="line">  <span class="comment">// do something with the files</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>In addition, the sorter can discover which series belong to the same study. That is, it can tell us which series were collected during the same imaging session. One thing the sorter does <em>not</em> do is sort the images in the series according to slice location. It only sorts the images according to the Instance Number embedded in each image, where the Instance Number gives the logical viewing order prescribed by the medical device that generated the images. It is up to the <a class="el" href="classvtk_d_i_c_o_m_reader.html" title="Read DICOM image files. ">vtkDICOMReader</a> to check the slice positions for the files and sort them by location before generating an image volume or time series.</p>
<div class="fragment"><div class="line"><span class="comment">// Sort the input filenames by series and study.</span></div>
<div class="line">sorter-&gt;SetInputFileNames(filenames);</div>
<div class="line">sorter-&gt;Update();</div>
<div class="line"></div>
<div class="line"><span class="comment">// Iterate through all of the studies that are present.</span></div>
<div class="line"><span class="keywordtype">int</span> n = sorter-&gt;GetNumberOfStudies();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Iterate through all of the series in this study.</span></div>
<div class="line">  <span class="keywordtype">int</span> j1 = sorter-&gt;GetFirstSeriesForStudy(i);</div>
<div class="line">  <span class="keywordtype">int</span> j2 = sorter-&gt;GetLastSeriesForStudy(i);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = j1; j &lt;= j2; j++)</div>
<div class="line">  {</div>
<div class="line">    vtkStringArray *sortedFiles = sorter-&gt;GetFileNamesForSeries(j);</div>
<div class="line">    <span class="comment">// do something with the files</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Oct 28 2017 22:41:39 for vtk-dicom by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
