<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>vtk-dicom: Image Orientation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">vtk-dicom
   &#160;<span id="projectnumber">0.8.4</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Image Orientation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Medical image orientation in VTK.</p>
<h2>Overview</h2>
<p>When people use the term "image orientation" with respect to medical images, they usually mean one or more of the items listed below:</p><ol type="1">
<li>The order in which the pixels, rows, and slices are stored in the computer's memory.</li>
<li>The orientation of the image slices in a real-world coordinate system, for example the patient coordinate system as defined by the medical imaging equipment that generated the images.</li>
<li>The orientation of the subject (patient) with respect to the viewer when the images are viewed on a workstation.</li>
</ol>
<p>The first of these, the way the data is stored in memory, should merely be an implementation detail, but unfortunately the vtkImageViewer class insists that the pixels must be arranged in memory such that the pixel at the bottom-left corner of the image is the pixel at the lowest address in memory. This is in conflict with DICOM, which stores the top-left pixel as the first pixel in the file. To provide compatibility with the vtkImageViewer, the default behavior of the <a class="el" href="classvtk_d_i_c_o_m_reader.html" title="Read DICOM image files. ">vtkDICOMReader</a> is to flip the image in memory while it is loading it from the file. This behavior can be turned off by calling reader-&gt;SetMemoryRowOrderToFileNative().</p>
<p>The second and third items in the list can be referred to as the real-world orientation, and the display orientation, respectively. Neither of these can be considered an implementation detail, as both of them are crucial to the user experience. Also, it is important not to confuse one with the other. An application that incorrectly manages the real-world orientation is seriously flawed, even if it manages to display the images to the user in the correct orientation.</p>
<p>The real-world orientation is provided by the GetPatientMatrix() method of the <a class="el" href="classvtk_d_i_c_o_m_reader.html" title="Read DICOM image files. ">vtkDICOMReader</a>. This method returns a vtkMatrix4x4 object that describes the coordinate transformation from the data coordinates of the vtkImageData that stores the image, to the real-world Patient Coordinate System defined in the DICOM standard. The matrix is used to correctly place the image in the VTK world coordinate system.</p>
<p>The PatientMatrix is constructed from the ImagePositionPatient and ImageOrientationPatient attributes in the series of DICOM files that are provided to the reader. Note that unless SetMemoryRowOrderToFileNative() has been called on the reader, the orientation of the matrix will be flipped with respect to ImageOrientationPatient in order to account for the fact that the image rows were flipped in memory.</p>
<div class="fragment"><div class="line">reader-&gt;SetMemoryRowOrderToFileNative(); <span class="comment">// keep native row order</span></div>
<div class="line">reader-&gt;Update(); <span class="comment">// update the reader</span></div>
<div class="line">vtkMatrix4x4 *matrix = reader-&gt;GetPatientMatrix();</div>
<div class="line"></div>
<div class="line"><span class="comment">// create an image actor and specify the orientation.</span></div>
<div class="line">vtkNew&lt;vtkImageActor&gt; actor;</div>
<div class="line">actor-&gt;GetMapper()-&gt;SetInputConnection(reader-&gt;GetOutputPort());</div>
<div class="line">actor-&gt;SetUserMatrix(matrix);</div>
</div><!-- fragment --><p>Setting the actor's UserMatrix will ensure that the real-world orientation of the image is correctly handled, as far as the VTK display pipeline is concerned. It does not, however, set the display orientation, which is the responsibility of the application. The display orientation can be set via manipulation of the VTK camera. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jul 16 2017 14:52:44 for vtk-dicom by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
