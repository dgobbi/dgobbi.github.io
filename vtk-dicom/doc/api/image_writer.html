<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>vtk-dicom: Image Writer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">vtk-dicom
   &#160;<span id="projectnumber">0.7.11</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Image Writer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Details on how to write DICOM images.</p>
<h2>Overview</h2>
<p>The <a class="el" href="classvtk_d_i_c_o_m_writer.html" title="Write DICOM image files. ">vtkDICOMWriter</a> takes a vtkImageData object as input, and writes a series of DICOM image files to disk. Since the required meta data for an image varies from one modality to another, the writer delegates the creation of the meta data to another class called <a class="el" href="classvtk_d_i_c_o_m_generator.html" title="Generate DICOM data series for specific IOD classes. ">vtkDICOMGenerator</a>. A short example of how this is done is as follows:</p>
<div class="fragment"><div class="line"><span class="comment">// Create a generator for MR images.</span></div>
<div class="line">vtkNew&lt;vtkDICOMMRGenerator&gt; generator;</div>
<div class="line"></div>
<div class="line"><span class="comment">// Create a meta data object with some desired attributes.</span></div>
<div class="line">vtkNew&lt;vtkDICOMMetaData&gt; meta;</div>
<div class="line">meta-&gt;<a class="code" href="classvtk_d_i_c_o_m_meta_data.html#a8115e49580d8103f42adf0ecffc7c307">SetAttributeValue</a>(DC::PatientName, <span class="stringliteral">&quot;Doe^John&quot;</span>);</div>
<div class="line">meta-&gt;SetAttributeValue(DC::ScanningSequence, <span class="stringliteral">&quot;GR&quot;</span>); <span class="comment">// Gradient Recalled</span></div>
<div class="line">meta-&gt;SetAttributeValue(DC::SequenceVatiant, <span class="stringliteral">&quot;SP&quot;</span>); <span class="comment">// Spoiled</span></div>
<div class="line">meta-&gt;SetAttributeValue(DC::ScanOptions, <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line">meta-&gt;SetAttributeValue(DC::MRAcquisitionType, <span class="stringliteral">&quot;2D&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Plug the generator and meta data into the writer.</span></div>
<div class="line">vtkNew&lt;vtkDICOMWriter&gt; writer;</div>
<div class="line">writer-&gt;SetInputConnection(lastFilter-&gt;GetOutputPort());</div>
<div class="line">writer-&gt;SetMetaData(meta.GetPointer());</div>
<div class="line">writer-&gt;SetGenerator(generator.GetPointer());</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set the output filename format as a printf-style string.</span></div>
<div class="line">writer-&gt;SetFilePattern(<span class="stringliteral">&quot;%s/IM-0001-%04.4d.dcm&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set the directory to write the files into.</span></div>
<div class="line">writer-&gt;SetFilePrefix(<span class="stringliteral">&quot;/the/output/directory&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Write the file.</span></div>
<div class="line">writer-&gt;Write();</div>
</div><!-- fragment --><p>The <a class="el" href="classvtk_d_i_c_o_m_m_r_generator.html" title="Generate DICOM data objects for MR images. ">vtkDICOMMRGenerator</a> assists with conformance by generating all the data set attributes that are required by the MR IOD. It will also scan through the vtkMetaData object that is provided to the writer, and use any of its attributes as long as 1) they are defined in the MR IOD, and 2) they are deemed to be valid for the image that is being written. A partial list of attributes that are never taken from the input meta data is as follows:</p><ol type="1">
<li><code>SOPInstanceUID</code> (this is always re-generated to ensure its uniqueness)</li>
<li><code>SeriesInstanceUID</code> (ditto)</li>
<li><code>ImageType</code> (this is set to <code>DERIVED\SECONDARY\OTHER</code> by default)</li>
<li><code>PixelSpacing</code> (this is set from the VTK image information)</li>
<li><code>Rows</code> and <code>Columns</code> (ditto)</li>
<li><code>ImagePositionPatient</code> and <code>ImageOrientationPatient</code> (these are set from the PatientMatrix)</li>
</ol>
<p>The generator always creates a new <code>SOPInstanceUID</code> for each file and a new <code>SeriesInstanceUID</code> for each series. There is no way to set these UIDs manually. The <code>ImageType</code> is set to <code>DERIVED</code> by default, because an image cannot be considered to be <code>ORIGINAL</code> if it was modifed in any way after its original acquisition. Finally, all information related to the pixel values or the slice geometry is generated from the vtkImageData information and from the PatientMatrix.</p>
<p>The <a class="el" href="classvtk_d_i_c_o_m_writer.html" title="Write DICOM image files. ">vtkDICOMWriter</a> allows several parameters, including <code>ImageType</code>, to be set when writing the file. These are demonstrated in the following example.</p>
<div class="fragment"><div class="line"><span class="comment">// Plug the generator and meta data into the writer.</span></div>
<div class="line">vtkNew&lt;vtkDICOMWriter&gt; writer;</div>
<div class="line">writer-&gt;SetInputConnection(lastFilter-&gt;GetOutputPort());</div>
<div class="line">writer-&gt;SetMetaData(meta.GetPointer());</div>
<div class="line">writer-&gt;SetGenerator(generator.GetPointer());</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set the output filename format as a printf-style string.</span></div>
<div class="line">writer-&gt;SetFilePattern(<span class="stringliteral">&quot;%s/IM-0001-%04.4d.dcm&quot;</span>);</div>
<div class="line"><span class="comment">// Set the directory to write the files into</span></div>
<div class="line">writer-&gt;SetFilePrefix(<span class="stringliteral">&quot;/the/output/directory&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set the image type to Multi-planar Reformat.</span></div>
<div class="line"><span class="comment">// (forward slashes will be converted to backward slashes)</span></div>
<div class="line">writer-&gt;SetImageType(<span class="stringliteral">&quot;DERIVED/SECONDARY/MPR&quot;</span>);</div>
<div class="line">writer-&gt;SetSeriesDescription(<span class="stringliteral">&quot;Sagittal Multi-planar Reformat&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">// Set the 4x4 matrix that gives the position and orientation.</span></div>
<div class="line">writer-&gt;SetPatientMatrix(patientMatrix);</div>
</div><!-- fragment --><h2>Customizing the generators</h2>
<p>At the present time, the <a class="el" href="classvtk_d_i_c_o_m_writer.html" title="Write DICOM image files. ">vtkDICOMWriter</a> has only three generators available: the <a class="el" href="classvtk_d_i_c_o_m_m_r_generator.html" title="Generate DICOM data objects for MR images. ">vtkDICOMMRGenerator</a> (for MR), the <a class="el" href="classvtk_d_i_c_o_m_c_t_generator.html" title="Generate DICOM data objects for CT images. ">vtkDICOMCTGenerator</a> (for CT), and the <a class="el" href="classvtk_d_i_c_o_m_s_c_generator.html" title="Generate DICOM data objects for Secondary Capture images. ">vtkDICOMSCGenerator</a> (for Secondary Capture, e.g. screenshots). Writing a new generator class is the recommended method for adding support for a new modality to the vtkDICOM library, though that is beyond the scope of this document.</p>
<h2>Writing a raw pixel buffer to a DICOM file</h2>
<p>In addition to the <a class="el" href="classvtk_d_i_c_o_m_writer.html" title="Write DICOM image files. ">vtkDICOMWriter</a>, there is a class called the <a class="el" href="classvtk_d_i_c_o_m_compiler.html" title="A writer for DICOM meta data. ">vtkDICOMCompiler</a> that can write meta data and image data directly to a file without it being processed by a <a class="el" href="classvtk_d_i_c_o_m_generator.html" title="Generate DICOM data series for specific IOD classes. ">vtkDICOMGenerator</a>. It can be used to efficiently perform such actions as changing the transfer syntax of the data or tweaking the meta data. By design, the <a class="el" href="classvtk_d_i_c_o_m_compiler.html" title="A writer for DICOM meta data. ">vtkDICOMCompiler</a> will take, as input, a meta data object that describes a series of images, and it will then write the files in the series one-by-one.</p>
<div class="fragment"><div class="line">vtkNew&lt;vtkDICOMCompiler&gt; compiler;</div>
<div class="line">compiler-&gt;SetMetaData(meta);</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> n = meta-&gt;GetNumberOfInstances();</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; n; i++)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span> outputFile[256];</div>
<div class="line">  sprintf(outputFile, <span class="stringliteral">&quot;IM-0001-%04.4d.dcm&quot;</span>, i+1);</div>
<div class="line">  compiler-&gt;SetFileName(outputFile);</div>
<div class="line">  compiler-&gt;SetIndex(i);</div>
<div class="line">  compiler-&gt;WriteHeader();</div>
<div class="line">  compiler-&gt;WritePixelData(rawPixelBufferForFile);</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Mar 11 2017 13:30:15 for vtk-dicom by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
